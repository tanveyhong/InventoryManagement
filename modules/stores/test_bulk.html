<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Bulk Operations</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            background: #f5f5f5;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #5568d3;
        }
        .danger {
            background: #dc3545;
        }
        .danger:hover {
            background: #c82333;
        }
        #output {
            background: white;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border: 1px solid #ddd;
        }
        th {
            background: #667eea;
            color: white;
        }
        .checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>üß™ Bulk Operations Test</h1>
    
    <div class="test-section">
        <h3>Test Stores</h3>
        <table>
            <thead>
                <tr>
                    <th><input type="checkbox" id="selectAll" class="checkbox" onchange="toggleSelectAll(this)"></th>
                    <th>Store Name</th>
                    <th>Store ID</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><input type="checkbox" class="store-checkbox checkbox" value="store_001"></td>
                    <td>Main Store</td>
                    <td>store_001</td>
                </tr>
                <tr>
                    <td><input type="checkbox" class="store-checkbox checkbox" value="store_002"></td>
                    <td>Branch Store</td>
                    <td>store_002</td>
                </tr>
                <tr>
                    <td><input type="checkbox" class="store-checkbox checkbox" value="store_003"></td>
                    <td>Downtown Store</td>
                    <td>store_003</td>
                </tr>
                <tr>
                    <td><input type="checkbox" class="store-checkbox checkbox" value="store_004"></td>
                    <td>Uptown Store</td>
                    <td>store_004</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <div class="test-section">
        <h3>Bulk Actions</h3>
        <p>Selected: <strong><span id="selectedCount">0</span></strong> store(s)</p>
        <button onclick="testBulkActivate()">‚úÖ Test Activate</button>
        <button onclick="testBulkDeactivate()">‚õî Test Deactivate</button>
        <button onclick="testBulkDelete()" class="danger">üóëÔ∏è Test Delete</button>
        <button onclick="testBulkExport()">üíæ Test Export</button>
        <button onclick="clearSelection()">‚ùå Clear Selection</button>
    </div>
    
    <div class="test-section">
        <h3>Console Output</h3>
        <div id="output"></div>
    </div>

    <script>
        let logs = [];
        
        function log(message, data = null) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            logs.unshift(logEntry);
            if (data) {
                logs.unshift(JSON.stringify(data, null, 2));
            }
            document.getElementById('output').textContent = logs.join('\n');
            console.log(message, data);
        }
        
        function toggleSelectAll(checkbox) {
            log('Toggle Select All clicked', {checked: checkbox.checked});
            const checkboxes = document.querySelectorAll('.store-checkbox');
            checkboxes.forEach(cb => {
                cb.checked = checkbox.checked;
            });
            updateCount();
        }
        
        function updateCount() {
            const checkboxes = document.querySelectorAll('.store-checkbox:checked');
            const count = checkboxes.length;
            document.getElementById('selectedCount').textContent = count;
            log(`Selection updated: ${count} store(s) selected`);
        }
        
        function getSelectedStoreIds() {
            const checkboxes = document.querySelectorAll('.store-checkbox:checked');
            const ids = Array.from(checkboxes).map(cb => cb.value);
            log('Getting selected store IDs', ids);
            return ids;
        }
        
        function clearSelection() {
            log('Clearing selection');
            const checkboxes = document.querySelectorAll('.store-checkbox');
            checkboxes.forEach(cb => cb.checked = false);
            document.getElementById('selectAll').checked = false;
            updateCount();
        }
        
        async function testBulkActivate() {
            const storeIds = getSelectedStoreIds();
            log('TEST: Bulk Activate called', {storeIds, count: storeIds.length});
            
            if (storeIds.length === 0) {
                alert('Please select at least one store');
                return;
            }
            
            try {
                const formData = new FormData();
                formData.append('action', 'bulk_activate');
                formData.append('store_ids', JSON.stringify(storeIds));
                
                log('Preparing request', {
                    url: 'api/store_operations.php',
                    action: 'bulk_activate',
                    store_ids: storeIds
                });
                
                const response = await fetch('api/store_operations.php', {
                    method: 'POST',
                    body: formData
                });
                
                log('Response received', {
                    status: response.status,
                    statusText: response.statusText,
                    ok: response.ok
                });
                
                const text = await response.text();
                log('Response text', text);
                
                try {
                    const data = JSON.parse(text);
                    log('Parsed JSON response', data);
                    
                    if (data.success) {
                        alert('‚úÖ ' + data.message);
                    } else {
                        alert('‚ùå Error: ' + data.message);
                    }
                } catch (e) {
                    log('JSON parse error', {error: e.message, text: text});
                    alert('Error: Invalid JSON response');
                }
                
            } catch (error) {
                log('Fetch error', {error: error.message, stack: error.stack});
                alert('Network error: ' + error.message);
            }
        }
        
        async function testBulkDeactivate() {
            const storeIds = getSelectedStoreIds();
            log('TEST: Bulk Deactivate called', {storeIds});
            
            if (storeIds.length === 0) {
                alert('Please select at least one store');
                return;
            }
            
            alert(`Would deactivate: ${storeIds.join(', ')}`);
        }
        
        async function testBulkDelete() {
            const storeIds = getSelectedStoreIds();
            log('TEST: Bulk Delete called', {storeIds});
            
            if (storeIds.length === 0) {
                alert('Please select at least one store');
                return;
            }
            
            alert(`Would delete: ${storeIds.join(', ')}`);
        }
        
        async function testBulkExport() {
            const storeIds = getSelectedStoreIds();
            log('TEST: Bulk Export called', {storeIds});
            
            if (storeIds.length === 0) {
                alert('Please select at least one store');
                return;
            }
            
            alert(`Would export: ${storeIds.join(', ')}`);
        }
        
        // Auto-update count when checkboxes change
        document.addEventListener('DOMContentLoaded', function() {
            log('Page loaded, attaching event listeners');
            const checkboxes = document.querySelectorAll('.store-checkbox');
            checkboxes.forEach(cb => {
                cb.addEventListener('change', updateCount);
            });
        });
        
        log('Script initialized');
    </script>
</body>
</html>
